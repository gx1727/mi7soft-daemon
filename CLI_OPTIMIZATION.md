# MI7Soft-Daemon CLI ä¼˜åŒ–æ–¹æ¡ˆ

**æ›´æ–°æ—¶é—´ï¼š** 2026-02-28 20:41  
**ç›®æ ‡ï¼š** CLI å·¥å…·ä¼˜åŒ–ï¼ˆä¸è€ƒè™‘ Web å‰ç«¯ï¼‰  

---

## ğŸ¯ CLI å·¥å…·æ ¸å¿ƒä¼˜åŒ–æ–¹å‘

### P0 - æ ¸å¿ƒåŠŸèƒ½å¢å¼ºï¼ˆé¢„è®¡5-7å¤©ï¼‰

#### 0.1 **è¿›ç¨‹è¾“å‡ºæ•è·ä¸æ—¥å¿—æŸ¥çœ‹** â­â­â­â­â­
**ä¼˜å…ˆçº§ï¼š** æé«˜  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** å¯æŸ¥çœ‹è¿›ç¨‹è¾“å‡ºï¼Œè°ƒè¯•å¿…å¤‡  

**å½“å‰é—®é¢˜ï¼š**
- å­è¿›ç¨‹ stdout/stderr æœªæ•è·
- æ— æ³•æŸ¥çœ‹è¿›ç¨‹è¾“å‡º
- æ— æ³•è¯Šæ–­é—®é¢˜

**è§£å†³æ–¹æ¡ˆï¼š**
```rust
// 1. æ•è·è¿›ç¨‹è¾“å‡º
pub struct ProcessConfig {
    pub log_file: Option<String>,  // å·²æœ‰
    pub capture_output: bool,      // æ–°å¢
    pub max_log_size: Option<u64>, // æ–°å¢ï¼šæ—¥å¿—è½®è½¬
}

// 2. æ·»åŠ æ—¥å¿—æŸ¥çœ‹å‘½ä»¤
mi7soft-daemon logs <name> [--follow] [--lines N]
mi7soft-daemon logs <name> --tail 100
mi7soft-daemon logs <name> --since "2h"

// 3. å®æ—¶æµè¾“å‡º
mi7soft-daemon logs <name> --follow  // ç±»ä¼¼ tail -f
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æ•è· stdout/stderr åˆ°æ–‡ä»¶
- [ ] å®ç° `logs` å‘½ä»¤
- [ ] æ”¯æŒå®æ—¶æµï¼ˆ--followï¼‰
- [ ] æ—¥å¿—è½®è½¬ï¼ˆé˜²æ­¢æ–‡ä»¶è¿‡å¤§ï¼‰
- [ ] æ—¥å¿—è¿‡æ»¤ï¼ˆæŒ‰æ—¶é—´ã€çº§åˆ«ï¼‰

---

#### 0.2 **æŒä¹…åŒ–å­˜å‚¨** â­â­â­â­â­
**ä¼˜å…ˆçº§ï¼š** æé«˜  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** çŠ¶æ€æŒä¹…åŒ–ï¼Œå†å²è®°å½•ï¼Œå®¡è®¡  

**å½“å‰é—®é¢˜ï¼š**
- è¿›ç¨‹ä¿¡æ¯åªåœ¨å†…å­˜ä¸­
- é‡å¯ä¸¢å¤±æ‰€æœ‰çŠ¶æ€
- æ— å†å²è®°å½•

**è§£å†³æ–¹æ¡ˆï¼š**
```rust
// ä½¿ç”¨ SQLite å­˜å‚¨è¿›ç¨‹å†å²
pub struct ProcessHistory {
    pub id: i64,
    pub name: String,
    pub pid: u32,
    pub start_time: i64,
    pub end_time: Option<i64>,
    pub exit_code: Option<i32>,
    pub restart_count: u32,
}

// æ–°å¢å‘½ä»¤
mi7soft-daemon history <name>        # æŸ¥çœ‹å†å²
mi7soft-daemon history <name> --last 10
mi7soft-daemon stats <name>          # ç»Ÿè®¡ä¿¡æ¯
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] é€‰æ‹©æ•°æ®åº“ï¼ˆSQLite/RocksDBï¼‰
- [ ] è®¾è®¡æ•°æ®æ¨¡å‹
- [ ] å®ç°å­˜å‚¨å±‚
- [ ] æ·»åŠ  history å‘½ä»¤
- [ ] æ·»åŠ ç»Ÿè®¡åŠŸèƒ½

---

#### 0.3 **ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ** â­â­â­â­â­
**ä¼˜å…ˆçº§ï¼š** æé«˜  
**å·¥ä½œé‡ï¼š** 0.5-1 å¤©  
**æ”¶ç›Šï¼š** æ—¥å¿—å¯è¿½æº¯ï¼Œè°ƒè¯•å‹å¥½  

**å½“å‰é—®é¢˜ï¼š**
```rust
eprintln!("Auto-restarting process: {}", name);  // ä¸è§„èŒƒ
println!("Started process {} with PID {}", name, pid);
```

**è§£å†³æ–¹æ¡ˆï¼š**
```rust
use tracing::{info, error, warn, debug};

// ç»“æ„åŒ–æ—¥å¿—
info!(
    process_name = %name,
    pid = pid,
    "Process started"
);

error!(
    process_name = %name,
    error = %e,
    "Failed to start process"
);

// æ—¥å¿—é…ç½®
mi7soft-daemon start --log-level info
mi7soft-daemon start --log-format json  // ç»“æ„åŒ–æ—¥å¿—
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å¼•å…¥ tracing crate
- [ ] æ›¿æ¢æ‰€æœ‰ eprintln!/println!
- [ ] é…ç½®æ—¥å¿—çº§åˆ«
- [ ] æ”¯æŒå¤šç§æ—¥å¿—æ ¼å¼
- [ ] æ—¥å¿—æ–‡ä»¶è½®è½¬

---

### P1 - CLI ä½“éªŒä¼˜åŒ–ï¼ˆé¢„è®¡3-5å¤©ï¼‰

#### 1.1 **è¾“å‡ºæ ¼å¼ç¾åŒ–** â­â­â­â­
**ä¼˜å…ˆçº§ï¼š** é«˜  
**å·¥ä½œé‡ï¼š** 1 å¤©  
**æ”¶ç›Šï¼š** ç”¨æˆ·ä½“éªŒå¤§å¹…æå‡  

**å½“å‰é—®é¢˜ï¼š**
```
Status for process php-worker:
  php-worker (PID: 1234, State: Running, Uptime: 3600s)
```

**æ”¹è¿›æ–¹æ¡ˆï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Process        â”‚ PID  â”‚ State   â”‚ Uptime   â”‚ Memory  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ php-worker     â”‚ 1234 â”‚ Running â”‚ 1h 0m 0s â”‚ 45.2 MB â”‚
â”‚ web-server     â”‚ 5678 â”‚ Running â”‚ 2h 30m   â”‚ 128 MB  â”‚
â”‚ background-job â”‚ 9012 â”‚ Stopped â”‚ -        â”‚ -       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ `tabled` crate ç”Ÿæˆè¡¨æ ¼
- ä½¿ç”¨ `colored` æˆ– `termcolor` æ·»åŠ é¢œè‰²
- æ”¯æŒ JSON è¾“å‡ºï¼ˆä¾¿äºè„šæœ¬å¤„ç†ï¼‰

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å¼•å…¥ tabled crate
- [ ] ç¾åŒ– status è¾“å‡º
- [ ] æ·»åŠ é¢œè‰²é«˜äº®
- [ ] æ”¯æŒ JSON æ ¼å¼ï¼ˆ--format jsonï¼‰

---

#### 1.2 **äº¤äº’å¼æ“ä½œ** â­â­â­â­
**ä¼˜å…ˆçº§ï¼š** é«˜  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** æ“ä½œæ›´ä¾¿æ·  

**æ–°å¢åŠŸèƒ½ï¼š**
```bash
# äº¤äº’å¼è¿›ç¨‹é€‰æ‹©
mi7soft-daemon stop --interactive

# å®æ—¶ç›‘æ§é¢æ¿ï¼ˆç±»ä¼¼ htopï¼‰
mi7soft-daemon top

# äº¤äº’å¼é…ç½®ç¼–è¾‘
mi7soft-daemon config edit
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æ·»åŠ äº¤äº’å¼é€‰æ‹©
- [ ] å®ç°å®æ—¶ç›‘æ§é¢æ¿
- [ ] é…ç½®ç¼–è¾‘å™¨

---

#### 1.3 **å‘½ä»¤è¡¥å…¨** â­â­â­
**ä¼˜å…ˆçº§ï¼š** ä¸­  
**å·¥ä½œé‡ï¼š** 0.5 å¤©  
**æ”¶ç›Šï¼š** æå‡æ•ˆç‡  

**æ”¯æŒï¼š**
- Bash è¡¥å…¨
- Zsh è¡¥å…¨
- Fish è¡¥å…¨

```bash
# ç”Ÿæˆè¡¥å…¨è„šæœ¬
mi7soft-daemon completion bash > /etc/bash_completion.d/mi7soft-daemon
mi7soft-daemon completion zsh > "${fpath[1]}/_mi7soft-daemon"
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] ä½¿ç”¨ clap_generate ç”Ÿæˆè¡¥å…¨
- [ ] æ”¯æŒ bash/zsh/fish
- [ ] æ–‡æ¡£è¯´æ˜

---

### P2 - åŠŸèƒ½å¢å¼ºï¼ˆé¢„è®¡5-7å¤©ï¼‰

#### 2.1 **è¿›ç¨‹åˆ†ç»„ç®¡ç†** â­â­â­â­
**ä¼˜å…ˆçº§ï¼š** é«˜  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** æ‰¹é‡ç®¡ç†  

**æ–°å¢åŠŸèƒ½ï¼š**
```toml
# é…ç½®æ–‡ä»¶
[groups.web]
processes = ["nginx", "php-fpm", "mysql"]

[groups.worker]
processes = ["queue-worker", "scheduler"]
```

```bash
# æŒ‰ç»„æ“ä½œ
mi7soft-daemon start-group web
mi7soft-daemon stop-group worker
mi7soft-daemon restart-group all
mi7soft-daemon status --group web
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æ·»åŠ åˆ†ç»„é…ç½®
- [ ] å®ç° start-group/stop-group
- [ ] åˆ†ç»„çŠ¶æ€æŸ¥è¯¢

---

#### 2.2 **ä¾èµ–ç®¡ç†** â­â­â­â­
**ä¼˜å…ˆçº§ï¼š** é«˜  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** å¯åŠ¨é¡ºåºæ§åˆ¶  

**é…ç½®ç¤ºä¾‹ï¼š**
```toml
[[processes]]
name = "web-app"
command = "/usr/bin/app"
depends_on = ["database", "redis"]  # æ–°å¢

[[processes]]
name = "database"
command = "/usr/bin/postgres"

[[processes]]
name = "redis"
command = "/usr/bin/redis-server"
```

**è¡Œä¸ºï¼š**
- å¯åŠ¨ web-app å‰ï¼Œè‡ªåŠ¨å¯åŠ¨ database å’Œ redis
- åœæ­¢ database æ—¶ï¼Œå…ˆåœæ­¢ä¾èµ–å®ƒçš„è¿›ç¨‹

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æ·»åŠ ä¾èµ–é…ç½®
- [ ] æ„å»ºä¾èµ–å›¾
- [ ] æ‹“æ‰‘æ’åºå¯åŠ¨
- [ ] ä¾èµ–æ£€æŸ¥

---

#### 2.3 **å¥åº·æ£€æŸ¥** â­â­â­â­
**ä¼˜å…ˆçº§ï¼š** é«˜  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** çœŸå®å¥åº·çŠ¶æ€  

**é…ç½®ç¤ºä¾‹ï¼š**
```toml
[[processes]]
name = "web-server"
command = "/usr/bin/python -m http.server 8000"

[processes.health_check]
type = "http"
url = "http://localhost:8000/health"
interval = 10
timeout = 5
retries = 3
```

**å¥åº·æ£€æŸ¥ç±»å‹ï¼š**
- HTTP æ£€æŸ¥
- TCP ç«¯å£æ£€æŸ¥
- è‡ªå®šä¹‰è„šæœ¬

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] HTTP å¥åº·æ£€æŸ¥
- [ ] TCP ç«¯å£æ£€æŸ¥
- [ ] è‡ªå®šä¹‰è„šæœ¬
- [ ] å¥åº·çŠ¶æ€æ˜¾ç¤º

---

#### 2.4 **èµ„æºç›‘æ§** â­â­â­â­
**ä¼˜å…ˆçº§ï¼š** é«˜  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** å®æ—¶ç›‘æ§  

**æ–°å¢å‘½ä»¤ï¼š**
```bash
# å®æ—¶ç›‘æ§
mi7soft-daemon top

# æŸ¥çœ‹èµ„æºä½¿ç”¨
mi7soft-daemon stats
mi7soft-daemon stats <name>

è¾“å‡ºç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Process     â”‚ PID  â”‚ CPU %  â”‚ Memory   â”‚ Status  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ web-server  â”‚ 1234 â”‚ 12.5%  â”‚ 128 MB   â”‚ Healthy â”‚
â”‚ worker      â”‚ 5678 â”‚ 45.2%  â”‚ 256 MB   â”‚ Healthy â”‚
â”‚ database    â”‚ 9012 â”‚ 8.3%   â”‚ 512 MB   â”‚ Healthy â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] CPU ä½¿ç”¨ç‡ç›‘æ§
- [ ] å†…å­˜ä½¿ç”¨ç›‘æ§
- [ ] å®æ—¶åˆ·æ–°ï¼ˆtop å‘½ä»¤ï¼‰
- [ ] ç»Ÿè®¡ä¿¡æ¯

---

#### 2.5 **ç¯å¢ƒå˜é‡ç®¡ç†** â­â­â­
**ä¼˜å…ˆçº§ï¼š** ä¸­  
**å·¥ä½œé‡ï¼š** 1 å¤©  
**æ”¶ç›Šï¼š** é…ç½®çµæ´»  

**é…ç½®ç¤ºä¾‹ï¼š**
```toml
# ä»æ–‡ä»¶åŠ è½½
[[processes]]
name = "app"
command = "/usr/bin/app"
env_file = ".env"  # æ–°å¢

# ç¯å¢ƒå˜é‡æ¨¡æ¿
[[processes]]
name = "worker"
command = "/usr/bin/worker"
[processes.environment]
DATABASE_URL = "postgres://localhost/db"
REDIS_URL = "redis://localhost"
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æ”¯æŒ .env æ–‡ä»¶
- [ ] ç¯å¢ƒå˜é‡éªŒè¯
- [ ] æ•æ„Ÿä¿¡æ¯åŠ å¯†

---

### P3 - ä»£ç è´¨é‡ï¼ˆé¢„è®¡3-5å¤©ï¼‰

#### 3.1 **æ–‡æ¡£å®Œå–„** â­â­â­
**ä¼˜å…ˆçº§ï¼š** ä¸­  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** å¯ç»´æŠ¤æ€§æå‡  

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] ä¸ºæ‰€æœ‰å…¬å…± API æ·»åŠ æ–‡æ¡£æ³¨é‡Š
- [ ] ç”Ÿæˆ rustdoc
- [ ] æ›´æ–° READMEï¼ˆæ·»åŠ æ›´å¤šç¤ºä¾‹ï¼‰
- [ ] æ·»åŠ  CONTRIBUTING.md
- [ ] æ·»åŠ  CHANGELOG.md

---

#### 3.2 **é”™è¯¯å¤„ç†æ”¹è¿›** â­â­â­
**ä¼˜å…ˆçº§ï¼š** ä¸­  
**å·¥ä½œé‡ï¼š** 1 å¤©  
**æ”¶ç›Šï¼š** æ›´å‹å¥½çš„é”™è¯¯ä¿¡æ¯  

**å½“å‰é—®é¢˜ï¼š**
```rust
let _ = self.process_manager.spawn(&config).await;  // å¿½ç•¥é”™è¯¯
```

**æ”¹è¿›æ–¹æ¡ˆï¼š**
```rust
if let Err(e) = self.process_manager.spawn(&config).await {
    error!(
        process_name = %config.name,
        error = %e,
        "Failed to start process"
    );
    // è®°å½•åˆ°æ•°æ®åº“
    // æ ¹æ®é…ç½®å†³å®šæ˜¯å¦é‡è¯•
}
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å¤„ç†æ‰€æœ‰è¢«å¿½ç•¥çš„é”™è¯¯
- [ ] æ·»åŠ é”™è¯¯ä¸Šä¸‹æ–‡
- [ ] å‹å¥½çš„é”™è¯¯æç¤º

---

#### 3.3 **æµ‹è¯•è¦†ç›–** â­â­â­
**ä¼˜å…ˆçº§ï¼š** ä¸­  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** ä»£ç è´¨é‡ä¿éšœ  

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å¢åŠ å•å…ƒæµ‹è¯•
- [ ] æ·»åŠ é›†æˆæµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 70%
- [ ] CI/CD é›†æˆ

---

### P4 - æ€§èƒ½ä¼˜åŒ–ï¼ˆé¢„è®¡2-3å¤©ï¼‰

#### 4.1 **äº‹ä»¶é©±åŠ¨ç›‘æ§** â­â­â­
**ä¼˜å…ˆçº§ï¼š** ä¸­  
**å·¥ä½œé‡ï¼š** 2-3 å¤©  
**æ”¶ç›Šï¼š** å‡å°‘ CPU ä½¿ç”¨  

**å½“å‰é—®é¢˜ï¼š**
```rust
// æ¯5ç§’è½®è¯¢ä¸€æ¬¡
let mut interval = tokio::time::interval(
    tokio::time::Duration::from_secs(check_interval)
);
```

**æ”¹è¿›æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ kqueue (BSD/macOS) æˆ– epoll (Linux)
- ç›‘å¬è¿›ç¨‹äº‹ä»¶ï¼ˆé€€å‡ºã€ä¿¡å·ç­‰ï¼‰
- å‡å°‘ä¸å¿…è¦çš„è½®è¯¢

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] ç ”ç©¶ kqueue/epoll
- [ ] å®ç°äº‹ä»¶ç›‘å¬
- [ ] æ€§èƒ½æµ‹è¯•

---

#### 4.2 **èµ„æºé™åˆ¶** â­â­â­
**ä¼˜å…ˆçº§ï¼š** ä¸­  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** é˜²æ­¢èµ„æºè€—å°½  

**é…ç½®ç¤ºä¾‹ï¼š**
```toml
[[processes]]
name = "worker"
command = "/usr/bin/worker"

[processes.limits]
cpu_quota = "50%"      # CPU é™åˆ¶
memory_limit = "512M"  # å†…å­˜é™åˆ¶
max_fds = 1024         # æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] CPU é™åˆ¶ï¼ˆcgroupsï¼‰
- [ ] å†…å­˜é™åˆ¶
- [ ] æ–‡ä»¶æè¿°ç¬¦é™åˆ¶

---

### P5 - å®‰å…¨åŠ å›ºï¼ˆé¢„è®¡2-3å¤©ï¼‰

#### 5.1 **æƒé™æ§åˆ¶** â­â­â­
**ä¼˜å…ˆçº§ï¼š** ä¸­  
**å·¥ä½œé‡ï¼š** 1-2 å¤©  
**æ”¶ç›Šï¼š** è®¿é—®æ§åˆ¶  

**åŠŸèƒ½ï¼š**
- æŒ‡å®šè¿è¡Œç”¨æˆ·
- é™åˆ¶å¯æ‰§è¡Œå‘½ä»¤
- é…ç½®æ–‡ä»¶æƒé™æ£€æŸ¥

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æŒ‡å®šç”¨æˆ·è¿è¡Œ
- [ ] å‘½ä»¤ç™½åå•
- [ ] æƒé™æ£€æŸ¥

---

#### 5.2 **å‘½ä»¤éªŒè¯** â­â­â­
**ä¼˜å…ˆçº§ï¼š** ä¸­  
**å·¥ä½œé‡ï¼š** 1 å¤©  
**æ”¶ç›Šï¼š** é˜²æ­¢æ¶æ„å‘½ä»¤  

**é…ç½®ç¤ºä¾‹ï¼š**
```toml
[security]
allowed_commands = [
    "/usr/bin/python*",
    "/usr/bin/node*",
    "/opt/myapp/*"
]
```

**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å‘½ä»¤ç™½åå•
- [ ] å‚æ•°éªŒè¯
- [ ] å±é™©å‘½ä»¤æ£€æµ‹

---

## ğŸ“Š ä¼˜åŒ–ä¼˜å…ˆçº§çŸ©é˜µï¼ˆCLI ä¸“ç”¨ï¼‰

| ä¼˜åŒ–é¡¹ | ä¼˜å…ˆçº§ | å·¥ä½œé‡ | æ”¶ç›Š | ROI |
|--------|--------|--------|------|-----|
| è¿›ç¨‹è¾“å‡ºæ•è· | â­â­â­â­â­ | 1-2å¤© | æé«˜ | **æé«˜** |
| æŒä¹…åŒ–å­˜å‚¨ | â­â­â­â­â­ | 1-2å¤© | æé«˜ | **æé«˜** |
| ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ | â­â­â­â­â­ | 0.5-1å¤© | æé«˜ | **æé«˜** |
| è¾“å‡ºæ ¼å¼ç¾åŒ– | â­â­â­â­ | 1å¤© | é«˜ | **é«˜** |
| å¥åº·æ£€æŸ¥ | â­â­â­â­ | 1-2å¤© | é«˜ | **é«˜** |
| èµ„æºç›‘æ§ | â­â­â­â­ | 1-2å¤© | é«˜ | **é«˜** |
| è¿›ç¨‹åˆ†ç»„ | â­â­â­â­ | 1-2å¤© | é«˜ | **é«˜** |
| ä¾èµ–ç®¡ç† | â­â­â­â­ | 1-2å¤© | é«˜ | **é«˜** |
| äº¤äº’å¼æ“ä½œ | â­â­â­â­ | 1-2å¤© | ä¸­ | **ä¸­** |
| å‘½ä»¤è¡¥å…¨ | â­â­â­ | 0.5å¤© | ä¸­ | **ä¸­** |
| æ–‡æ¡£å®Œå–„ | â­â­â­ | 1-2å¤© | ä¸­ | **ä¸­** |
| äº‹ä»¶é©±åŠ¨ | â­â­â­ | 2-3å¤© | ä¸­ | **ä½** |

---

## ğŸš€ æ¨èä¼˜åŒ–è·¯å¾„ï¼ˆCLI ä¸“ç”¨ï¼‰

### è·¯å¾„ Aï¼šæ ¸å¿ƒåŠŸèƒ½å¢å¼ºï¼ˆæ¨èï¼‰
**æ—¶é—´ï¼š** 3-5 å¤©  
**ç›®æ ‡ï¼š** å¢å¼ºæ ¸å¿ƒåŠŸèƒ½ï¼Œæå‡å¯ç”¨æ€§  

**æ­¥éª¤ï¼š**
1. ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼ˆ0.5-1å¤©ï¼‰
2. è¿›ç¨‹è¾“å‡ºæ•è·ï¼ˆ1-2å¤©ï¼‰
3. æŒä¹…åŒ–å­˜å‚¨ï¼ˆ1-2å¤©ï¼‰

**é¢„æœŸæ•ˆæœï¼š**
- âœ… æ—¥å¿—å¯è¿½æº¯
- âœ… å¯æŸ¥çœ‹è¿›ç¨‹è¾“å‡º
- âœ… çŠ¶æ€æŒä¹…åŒ–
- âœ… å†å²è®°å½•å¯æŸ¥

---

### è·¯å¾„ Bï¼šCLI ä½“éªŒä¼˜åŒ–
**æ—¶é—´ï¼š** 3-5 å¤©  
**ç›®æ ‡ï¼š** æå‡ç”¨æˆ·ä½“éªŒ  

**æ­¥éª¤ï¼š**
1. è¾“å‡ºæ ¼å¼ç¾åŒ–ï¼ˆ1å¤©ï¼‰
2. äº¤äº’å¼æ“ä½œï¼ˆ1-2å¤©ï¼‰
3. å‘½ä»¤è¡¥å…¨ï¼ˆ0.5å¤©ï¼‰
4. èµ„æºç›‘æ§ï¼ˆ1-2å¤©ï¼‰

**é¢„æœŸæ•ˆæœï¼š**
- âœ… è¾“å‡ºç¾è§‚æ˜“è¯»
- âœ… æ“ä½œä¾¿æ·
- âœ… å®æ—¶ç›‘æ§

---

### è·¯å¾„ Cï¼šåŠŸèƒ½å¢å¼º
**æ—¶é—´ï¼š** 5-7 å¤©  
**ç›®æ ‡ï¼š** å¢å¼ºç®¡ç†èƒ½åŠ›  

**æ­¥éª¤ï¼š**
1. è¿›ç¨‹åˆ†ç»„ï¼ˆ1-2å¤©ï¼‰
2. ä¾èµ–ç®¡ç†ï¼ˆ1-2å¤©ï¼‰
3. å¥åº·æ£€æŸ¥ï¼ˆ1-2å¤©ï¼‰
4. ç¯å¢ƒå˜é‡ç®¡ç†ï¼ˆ1å¤©ï¼‰

**é¢„æœŸæ•ˆæœï¼š**
- âœ… æ‰¹é‡ç®¡ç†
- âœ… å¯åŠ¨é¡ºåºæ§åˆ¶
- âœ… çœŸå®å¥åº·çŠ¶æ€

---

### è·¯å¾„ Dï¼šå…¨é¢ä¼˜åŒ–
**æ—¶é—´ï¼š** 15-20 å¤©  
**ç›®æ ‡ï¼š** ç”Ÿäº§çº§ CLI å·¥å…·  

**åŒ…å«ï¼š**
- è·¯å¾„ A + B + C
- ä»£ç è´¨é‡æå‡
- æ€§èƒ½ä¼˜åŒ–
- å®‰å…¨åŠ å›º

---

## ğŸ’¡ å¿«é€Ÿä¼˜åŒ–å»ºè®®ï¼ˆç«‹å³å¯åšï¼‰

### 1. æ·»åŠ  tracing æ—¥å¿—ï¼ˆ30åˆ†é’Ÿï¼‰

```toml
# Cargo.toml
[dependencies]
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }
```

```rust
// main.rs
use tracing::{info, error, Level};
use tracing_subscriber::EnvFilter;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    tracing_subscriber::fmt()
        .with_env_filter(EnvFilter::from_default_env())
        .init();
    
    info!("Daemon starting...");
    // ...
}
```

### 2. æ•è·è¿›ç¨‹è¾“å‡ºï¼ˆ1å°æ—¶ï¼‰

```rust
// process.rs
pub async fn spawn(&mut self, config: &ProcessConfig) -> Result<u32, DaemonError> {
    let mut cmd = tokio::process::Command::new(&config.command);
    cmd.args(&config.args);
    
    // æ•è·è¾“å‡º
    if config.capture_output {
        cmd.stdout(std::process::Stdio::piped());
        cmd.stderr(std::process::Stdio::piped());
    }
    
    let mut child = cmd.spawn()?;
    let pid = child.id().unwrap() as u32;
    
    // æ•è·è¾“å‡ºåˆ°æ–‡ä»¶
    if config.capture_output {
        if let Some(stdout) = child.stdout.take() {
            let log_file = config.log_file.clone();
            tokio::spawn(async move {
                use tokio::io::AsyncBufReadExt;
                let reader = tokio::io::BufReader::new(stdout).lines();
                if let Ok(mut file) = tokio::fs::OpenOptions::new()
                    .create(true)
                    .append(true)
                    .open(log_file.unwrap_or_default())
                    .await
                {
                    while let Ok(Some(line)) = reader.next_line().await {
                        use tokio::io::AsyncWriteExt;
                        let _ = file.write_all(format!("{}\n", line).as_bytes()).await;
                    }
                }
            });
        }
    }
    
    Ok(pid)
}
```

### 3. ç¾åŒ–è¾“å‡ºï¼ˆ30åˆ†é’Ÿï¼‰

```toml
# Cargo.toml
[dependencies]
tabled = "0.15"
colored = "2.1"
```

```rust
// cli.rs
use tabled::{Table, Tabled, settings::Style};
use colored::Colorize;

#[derive(Tabled)]
struct ProcessRow {
    #[tabled(rename = "Process")]
    name: String,
    #[tabled(rename = "PID")]
    pid: u32,
    #[tabled(rename = "State")]
    state: String,
    #[tabled(rename = "Uptime")]
    uptime: String,
}

fn display_status(statuses: Vec<ProcessStatus>) {
    let rows: Vec<ProcessRow> = statuses
        .into_iter()
        .map(|s| ProcessRow {
            name: s.name.green().to_string(),
            pid: s.pid,
            state: format!("{:?}", s.state).blue().to_string(),
            uptime: format!("{}s", s.uptime),
        })
        .collect();
    
    let table = Table::new(rows)
        .with(Style::rounded())
        .to_string();
    
    println!("{}", table);
}
```

---

## ğŸ“ æ€»ç»“

### CLI å·¥å…·ä¼˜åŒ–é‡ç‚¹

**æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¿…åšï¼‰ï¼š**
1. âœ… è¿›ç¨‹è¾“å‡ºæ•è·ï¼ˆè°ƒè¯•å¿…å¤‡ï¼‰
2. âœ… æŒä¹…åŒ–å­˜å‚¨ï¼ˆå†å²è®°å½•ï¼‰
3. âœ… ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿï¼ˆå¯è¿½æº¯ï¼‰

**ç”¨æˆ·ä½“éªŒï¼ˆæ¨èï¼‰ï¼š**
1. âœ… è¾“å‡ºæ ¼å¼ç¾åŒ–
2. âœ… äº¤äº’å¼æ“ä½œ
3. âœ… å®æ—¶ç›‘æ§

**åŠŸèƒ½å¢å¼ºï¼ˆå¯é€‰ï¼‰ï¼š**
1. â­ è¿›ç¨‹åˆ†ç»„
2. â­ ä¾èµ–ç®¡ç†
3. â­ å¥åº·æ£€æŸ¥
4. â­ èµ„æºç›‘æ§

### å»ºè®®

**ä¼˜å…ˆæ‰§è¡Œè·¯å¾„ Aï¼ˆæ ¸å¿ƒåŠŸèƒ½å¢å¼ºï¼‰**ï¼Œè®© CLI å·¥å…·çœŸæ­£å®ç”¨ã€‚

**æ—¶é—´æŠ•å…¥ï¼š** 3-5 å¤©  
**æ•ˆæœï¼š** æ—¥å¿—å¯æŸ¥ã€è¾“å‡ºå¯è§ã€çŠ¶æ€æŒä¹…

---

*æ›´æ–°æ—¶é—´ï¼š2026-02-28 20:45*  
*åˆ†æè€…ï¼šæ˜Ÿå°˜ (OpenClaw AI Assistant)*
